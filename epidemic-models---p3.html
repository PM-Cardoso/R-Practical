<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Epidemic models - P3 | R-Practical</title>
  <meta name="description" content="7 Epidemic models - P3 | R-Practical" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Epidemic models - P3 | R-Practical" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="7 Epidemic models - P3 | R-Practical" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Epidemic models - P3 | R-Practical" />
  
  <meta name="twitter:description" content="7 Epidemic models - P3 | R-Practical" />
  

<meta name="author" content="Pedro Cardoso" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="epidemic-models---p2.html"/>
<link rel="next" href="estimating-r_0---p1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script language="javascript"> 
    function toggle(id) {
        var ele = document.getElementById("toggleText" + id);
        var text = document.getElementById("displayText" + id);
        var buttonText = text.innerHTML.replace("Show: ", "");
        buttonText = buttonText.replace("Hide: ", "");
        if(ele.style.display == "block") {
            ele.style.display = "none";
            text.innerHTML = "Show: " + buttonText;
        } else {
            ele.style.display = "block";
            text.innerHTML = "Hide: " + buttonText;
        }
    } 
</script>

<script language="javascript">
    function openCode(evt, codeName, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent" + id);
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks" + id);
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(codeName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>

<script language="javascript">
    function hide(id){
        document.getElementById(id).style.display = "none";
    }
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Opening</a></li>
<li class="chapter" data-level="2" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html"><i class="fa fa-check"></i><b>2</b> Programming Practical - P1</a>
<ul>
<li class="chapter" data-level="2.1" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#getting-started"><i class="fa fa-check"></i><b>2.1</b> Getting started</a></li>
<li class="chapter" data-level="2.2" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#predicting-the-behaviour-of-for-loops"><i class="fa fa-check"></i><b>2.2</b> Predicting the behaviour of for loops</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#example-one"><i class="fa fa-check"></i><b>2.2.1</b> Example one</a></li>
<li class="chapter" data-level="2.2.2" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#example-two"><i class="fa fa-check"></i><b>2.2.2</b> Example two</a></li>
<li class="chapter" data-level="2.2.3" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#example-three"><i class="fa fa-check"></i><b>2.2.3</b> Example three</a></li>
<li class="chapter" data-level="2.2.4" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#example-four"><i class="fa fa-check"></i><b>2.2.4</b> Example four</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#writing-a-for-loop"><i class="fa fa-check"></i><b>2.3</b> Writing a for loop</a></li>
<li class="chapter" data-level="2.4" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#writing-a-while-loop"><i class="fa fa-check"></i><b>2.4</b> Writing a while loop</a></li>
<li class="chapter" data-level="2.5" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#using-loops-to-do-more-complex-calculations"><i class="fa fa-check"></i><b>2.5</b> Using loops to do more complex calculations</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#a-loop-for-which-the-number-of-iterations-is-known-in-advance"><i class="fa fa-check"></i><b>2.5.1</b> A loop for which the number of iterations is known in advance</a></li>
<li class="chapter" data-level="2.5.2" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#a-loop-for-which-the-number-of-iterations-is-not-know-in-advance"><i class="fa fa-check"></i><b>2.5.2</b> A loop for which the number of iterations is not know in advance</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#writing-simple-functions"><i class="fa fa-check"></i><b>2.6</b> Writing simple functions</a></li>
<li class="chapter" data-level="2.7" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#predicting-the-behaviour-of-a-function"><i class="fa fa-check"></i><b>2.7</b> Predicting the behaviour of a function</a></li>
<li class="chapter" data-level="2.8" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#return-values-from-functions"><i class="fa fa-check"></i><b>2.8</b> Return values from functions</a></li>
<li class="chapter" data-level="2.9" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#additional-tasks-for-those-with-programming-experience"><i class="fa fa-check"></i><b>2.9</b> Additional tasks for those with programming experience</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#extended-example-one-monte-carlo-simulation"><i class="fa fa-check"></i><b>2.9.1</b> Extended example one: Monte Carlo simulation</a></li>
<li class="chapter" data-level="2.9.2" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#extended-example-two-the-logistic-map"><i class="fa fa-check"></i><b>2.9.2</b> Extended example two: the logistic map</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="programming-practical---p1.html"><a href="programming-practical---p1.html#appendix-relating-sticker-collecting-to-the-harmonic-numbers"><i class="fa fa-check"></i><b>2.10</b> Appendix: relating sticker collecting to the harmonic numbers</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html"><i class="fa fa-check"></i><b>3</b> Programming Practical - P2</a>
<ul>
<li class="chapter" data-level="3.1" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#random-variables"><i class="fa fa-check"></i><b>3.1</b> Random variables</a></li>
<li class="chapter" data-level="3.2" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#probability-distributions"><i class="fa fa-check"></i><b>3.2</b> Probability distributions</a></li>
<li class="chapter" data-level="3.3" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#using-probability-distributions-in-r---types"><i class="fa fa-check"></i><b>3.3</b> Using probability distributions in R - types</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#ddist"><i class="fa fa-check"></i><b>3.3.1</b> <code>ddist()</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#pdist"><i class="fa fa-check"></i><b>3.3.2</b> <code>pdist()</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#rdist"><i class="fa fa-check"></i><b>3.3.3</b> <code>rdist()</code></a></li>
<li class="chapter" data-level="3.3.4" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#rnorm---normal-distribution"><i class="fa fa-check"></i><b>3.3.4</b> <code>rnorm()</code> - Normal Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#example-one---using-probabilities-for-simulation"><i class="fa fa-check"></i><b>3.4</b> Example one - using probabilities for simulation</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#binomial-distribution"><i class="fa fa-check"></i><b>3.4.1</b> Binomial Distribution</a></li>
<li class="chapter" data-level="3.4.2" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#normal-distribution"><i class="fa fa-check"></i><b>3.4.2</b> Normal Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#example-two---multiple-choices"><i class="fa fa-check"></i><b>3.5</b> Example two - multiple choices</a></li>
<li class="chapter" data-level="3.6" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#exercise-one---using-r-to-model-a-die"><i class="fa fa-check"></i><b>3.6</b> Exercise one - using R to model a die</a></li>
<li class="chapter" data-level="3.7" data-path="programming-practical---p2.html"><a href="programming-practical---p2.html#example-three---using-r-to-model-a-death-process-stochastically"><i class="fa fa-check"></i><b>3.7</b> Example three - using R to model a death process stochastically</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dynamic-models-practical.html"><a href="dynamic-models-practical.html"><i class="fa fa-check"></i><b>4</b> Dynamic models Practical</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dynamic-models-practical.html"><a href="dynamic-models-practical.html#introduction-to-desolve"><i class="fa fa-check"></i><b>4.1</b> Introduction to deSolve</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="dynamic-models-practical.html"><a href="dynamic-models-practical.html#a-bit-of-theory"><i class="fa fa-check"></i><b>4.1.1</b> A bit of theory</a></li>
<li class="chapter" data-level="4.1.2" data-path="dynamic-models-practical.html"><a href="dynamic-models-practical.html#the-return-of-the-logistic-model"><i class="fa fa-check"></i><b>4.1.2</b> The return of the logistic model</a></li>
<li class="chapter" data-level="4.1.3" data-path="dynamic-models-practical.html"><a href="dynamic-models-practical.html#the-revenge-of-the-amoeba"><i class="fa fa-check"></i><b>4.1.3</b> The revenge of the amoeba</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="epidemic-models---p1.html"><a href="epidemic-models---p1.html"><i class="fa fa-check"></i><b>5</b> Epidemic models - P1</a>
<ul>
<li class="chapter" data-level="5.1" data-path="epidemic-models---p1.html"><a href="epidemic-models---p1.html#the-basic-sir-model"><i class="fa fa-check"></i><b>5.1</b> The basic SIR model</a></li>
<li class="chapter" data-level="5.2" data-path="epidemic-models---p1.html"><a href="epidemic-models---p1.html#coding-the-model"><i class="fa fa-check"></i><b>5.2</b> Coding the model</a></li>
<li class="chapter" data-level="5.3" data-path="epidemic-models---p1.html"><a href="epidemic-models---p1.html#some-properties-of-the-model"><i class="fa fa-check"></i><b>5.3</b> Some properties of the model</a></li>
<li class="chapter" data-level="5.4" data-path="epidemic-models---p1.html"><a href="epidemic-models---p1.html#calculating-the-infectious-period"><i class="fa fa-check"></i><b>5.4</b> Calculating the infectious period</a></li>
<li class="chapter" data-level="5.5" data-path="epidemic-models---p1.html"><a href="epidemic-models---p1.html#optional-section---extending-sir-to-other-compartments"><i class="fa fa-check"></i><b>5.5</b> Optional section - extending SIR to other compartments</a></li>
<li class="chapter" data-level="5.6" data-path="epidemic-models---p1.html"><a href="epidemic-models---p1.html#appendeix---epidemic-peak-and-final-epidemic-size"><i class="fa fa-check"></i><b>5.6</b> Appendeix - Epidemic peak and final epidemic size</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="epidemic-models---p2.html"><a href="epidemic-models---p2.html"><i class="fa fa-check"></i><b>6</b> Epidemic models - P2</a>
<ul>
<li class="chapter" data-level="6.1" data-path="epidemic-models---p2.html"><a href="epidemic-models---p2.html#calculating-r_0"><i class="fa fa-check"></i><b>6.1</b> Calculating <span class="math inline">\(R_{0}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html"><i class="fa fa-check"></i><b>7</b> Epidemic models - P3</a>
<ul>
<li class="chapter" data-level="7.1" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#coding-a-simple-si-model"><i class="fa fa-check"></i><b>7.1</b> Coding a simple SI model</a></li>
<li class="chapter" data-level="7.2" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#dissecting-the-stochastic-si-code"><i class="fa fa-check"></i><b>7.2</b> Dissecting the stochastic SI code</a></li>
<li class="chapter" data-level="7.3" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#performing-multiple-simulations"><i class="fa fa-check"></i><b>7.3</b> Performing Multiple Simulations</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#adding-the-deterministic-solution-curve"><i class="fa fa-check"></i><b>7.3.1</b> Adding the deterministic solution curve</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exploring-the-effects-of-stochasticity"><i class="fa fa-check"></i><b>7.4</b> Exploring the effects of Stochasticity</a></li>
<li class="chapter" data-level="7.5" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#the-delay-time"><i class="fa fa-check"></i><b>7.5</b> The delay time</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#the-deterministic-half-time"><i class="fa fa-check"></i><b>7.5.1</b> The deterministic half-time</a></li>
<li class="chapter" data-level="7.5.2" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#the-stochastic-half-time"><i class="fa fa-check"></i><b>7.5.2</b> The stochastic half-time</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#coding-a-simple-sir-model"><i class="fa fa-check"></i><b>7.6</b> Coding a simple SIR model</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exercise-one"><i class="fa fa-check"></i><b>7.6.1</b> Exercise one</a></li>
<li class="chapter" data-level="7.6.2" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exercise-two"><i class="fa fa-check"></i><b>7.6.2</b> Exercise two</a></li>
<li class="chapter" data-level="7.6.3" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exercise-three"><i class="fa fa-check"></i><b>7.6.3</b> Exercise three</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#sis-extension-adding-recovery-from-infection"><i class="fa fa-check"></i><b>7.7</b> SIS Extension: Adding Recovery from Infection</a></li>
<li class="chapter" data-level="7.8" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#sis-extension-adding-host-demography"><i class="fa fa-check"></i><b>7.8</b> SIS Extension: Adding host demography</a></li>
<li class="chapter" data-level="7.9" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#sir-extension-the-final-epidemic-size"><i class="fa fa-check"></i><b>7.9</b> SIR Extension: The final epidemic size</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exercise-one-1"><i class="fa fa-check"></i><b>7.9.1</b> Exercise one</a></li>
<li class="chapter" data-level="7.9.2" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exercise-two-1"><i class="fa fa-check"></i><b>7.9.2</b> Exercise two</a></li>
<li class="chapter" data-level="7.9.3" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exercise-three-1"><i class="fa fa-check"></i><b>7.9.3</b> Exercise three</a></li>
<li class="chapter" data-level="7.9.4" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exercise-four"><i class="fa fa-check"></i><b>7.9.4</b> Exercise four</a></li>
<li class="chapter" data-level="7.9.5" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exercise-five"><i class="fa fa-check"></i><b>7.9.5</b> Exercise five</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#sir-extension-stochastic-extinction"><i class="fa fa-check"></i><b>7.10</b> SIR Extension: Stochastic extinction</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#question"><i class="fa fa-check"></i><b>7.10.1</b> Question</a></li>
<li class="chapter" data-level="7.10.2" data-path="epidemic-models---p3.html"><a href="epidemic-models---p3.html#exercise-one-2"><i class="fa fa-check"></i><b>7.10.2</b> Exercise one</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="estimating-r_0---p1.html"><a href="estimating-r_0---p1.html"><i class="fa fa-check"></i><b>8</b> Estimating <span class="math inline">\(R_{0}\)</span> - P1</a>
<ul>
<li class="chapter" data-level="8.1" data-path="estimating-r_0---p1.html"><a href="estimating-r_0---p1.html#introduction-models-and-data-sets"><i class="fa fa-check"></i><b>8.1</b> Introduction: Models and Data sets</a></li>
<li class="chapter" data-level="8.2" data-path="estimating-r_0---p1.html"><a href="estimating-r_0---p1.html#final-size-method"><i class="fa fa-check"></i><b>8.2</b> Final Size Method</a></li>
<li class="chapter" data-level="8.3" data-path="estimating-r_0---p1.html"><a href="estimating-r_0---p1.html#regression-method"><i class="fa fa-check"></i><b>8.3</b> Regression Method</a></li>
<li class="chapter" data-level="8.4" data-path="estimating-r_0---p1.html"><a href="estimating-r_0---p1.html#recon-earlyr-method"><i class="fa fa-check"></i><b>8.4</b> RECON earlyR method</a></li>
<li class="chapter" data-level="8.5" data-path="estimating-r_0---p1.html"><a href="estimating-r_0---p1.html#appendix"><i class="fa fa-check"></i><b>8.5</b> Appendix</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="seasonality-and-measles-epidemics.html"><a href="seasonality-and-measles-epidemics.html"><i class="fa fa-check"></i><b>9</b> Seasonality and Measles Epidemics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="seasonality-and-measles-epidemics.html"><a href="seasonality-and-measles-epidemics.html#measles-data-and-challenge"><i class="fa fa-check"></i><b>9.1</b> Measles data and challenge</a></li>
<li class="chapter" data-level="9.2" data-path="seasonality-and-measles-epidemics.html"><a href="seasonality-and-measles-epidemics.html#standard-seir-exponential-with-sinusoidal-forcing"><i class="fa fa-check"></i><b>9.2</b> Standard SEIR (exponential) with sinusoidal forcing</a></li>
<li class="chapter" data-level="9.3" data-path="seasonality-and-measles-epidemics.html"><a href="seasonality-and-measles-epidemics.html#standard-seir-exponential-with-term-time-forcing"><i class="fa fa-check"></i><b>9.3</b> Standard SEIR (exponential) with term-time forcing</a></li>
<li class="chapter" data-level="9.4" data-path="seasonality-and-measles-epidemics.html"><a href="seasonality-and-measles-epidemics.html#gamma-seir-with-term-time-forcing"><i class="fa fa-check"></i><b>9.4</b> Gamma SEIR with term-time forcing</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="outbreak-of-influenza-in-a-boarding-school.html"><a href="outbreak-of-influenza-in-a-boarding-school.html"><i class="fa fa-check"></i><b>10</b> Outbreak of influenza in a boarding school</a>
<ul>
<li class="chapter" data-level="10.1" data-path="outbreak-of-influenza-in-a-boarding-school.html"><a href="outbreak-of-influenza-in-a-boarding-school.html#data-summary-and-challenge"><i class="fa fa-check"></i><b>10.1</b> Data Summary and challenge</a></li>
<li class="chapter" data-level="10.2" data-path="outbreak-of-influenza-in-a-boarding-school.html"><a href="outbreak-of-influenza-in-a-boarding-school.html#deterministic-model"><i class="fa fa-check"></i><b>10.2</b> Deterministic model</a></li>
<li class="chapter" data-level="10.3" data-path="outbreak-of-influenza-in-a-boarding-school.html"><a href="outbreak-of-influenza-in-a-boarding-school.html#stochastic-model"><i class="fa fa-check"></i><b>10.3</b> Stochastic model</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R-Practical</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="epidemic-models---p3" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Epidemic models - P3<a href="epidemic-models---p3.html#epidemic-models---p3" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Stochastic models</strong></p>
<p><em>Aim</em>: To explore the effects of stochasticity on simple SI and SIR models and contrast their behaviour with previous deterministic results.</p>
<p><em>Goals</em>:</p>
<p>By the end of this practical participants should be able to achieve the following:</p>
<ul>
<li>Code up a simple stochastic SI model in R using the <code>SimInf</code> package</li>
<li>Code up a simple stochastic SIR model in R using the <code>SimInf</code> package</li>
<li>Run both single and multiple realisations and visualise the results</li>
<li>Explore extensions to both SI and SIR models
<ul>
<li>Expand the SI model to include additional transitions</li>
<li>Understand the impact of R0 values on stochastic extinction</li>
</ul></li>
</ul>
<p><em>Background</em>: This practical follows on from the Stochastic Epidemic Models Lecture 5 and echoes the content presented there.</p>
<div id="coding-a-simple-si-model" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Coding a simple SI model<a href="epidemic-models---p3.html#coding-a-simple-si-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will first implement a slight modification to the code that has been presented to you in the previous Stochastic Epidemic Lecture (Epidemics L5). The key difference between the code presented in the lecture and the code shown here is that we are putting the code into a function (called <code>StocSI.dyn</code>) rather than just running a series of commands.</p>
<ul>
<li>Open Rstudio</li>
<li>Open a new blank script file</li>
<li>Save it as <code>Stock_SI.R</code></li>
</ul>
<p>If you haven’t already instealled the package <code>SimInf</code>:</p>
<ul>
<li>Click packages tab in lower right sub-window</li>
<li>Click Install</li>
<li>Type: <code>SimInf</code> in the Packages box</li>
<li>Click Install</li>
</ul>
<p>If you’re on a Windows computer then you’ll need to do some additional work to use <code>SimInf</code> (macOs and Linux users should be fine)</p>
<ul>
<li>Download Rtools from <a href="https://cran.r-project.org/bin/windows/Rtools/">https://cran.r-project.org/bin/windows/Rtools/</a>
<ul>
<li>Click on the appropriate version of RTools on the left</li>
<li>For RTools 4.2 (the most up to date version) click on the link <code>Rtools42_installer</code>. It’s in the third paragraph down in the second section</li>
<li>Once it’s downloaded install it using all of the default settings</li>
<li>This might take a couple of minutes, but click Finish when it’s done</li>
</ul></li>
<li>Add the path to Rtools to your PATH environment variable
<ul>
<li>Click on the windows icon in the bottom right of the screen</li>
<li>Type environment variable in the search box</li>
<li>This should bring up the System Properties window. Click on the Environment Variables button</li>
<li>Select on the <em>Path</em> row in the second table (entitled System Variables) and click Edit…</li>
<li>Click New</li>
<li>Type <code>C:\Rtools\bin</code></li>
<li>Click OK on all windows</li>
</ul></li>
</ul>
<p>Great!</p>
<p>Now we can finally actually get on with the simulations.</p>
<p><strong>In the script window type the following commands</strong>:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="epidemic-models---p3.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(SimInf)</span>
<span id="cb112-2"><a href="epidemic-models---p3.html#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="epidemic-models---p3.html#cb112-3" aria-hidden="true" tabindex="-1"></a>create.StocSI <span class="ot">&lt;-</span> <span class="cf">function</span>(N, I0, beta , f_time) {</span>
<span id="cb112-4"><a href="epidemic-models---p3.html#cb112-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-5"><a href="epidemic-models---p3.html#cb112-5" aria-hidden="true" tabindex="-1"></a>    initial_state <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">S =</span> N<span class="sc">-</span>I0 , <span class="at">I =</span> I0)</span>
<span id="cb112-6"><a href="epidemic-models---p3.html#cb112-6" aria-hidden="true" tabindex="-1"></a>    compartments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;I&quot;</span>)</span>
<span id="cb112-7"><a href="epidemic-models---p3.html#cb112-7" aria-hidden="true" tabindex="-1"></a>    transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S -&gt; beta*S*I/(S+I) -&gt; I&quot;</span>)</span>
<span id="cb112-8"><a href="epidemic-models---p3.html#cb112-8" aria-hidden="true" tabindex="-1"></a>    tspan <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> f_time, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb112-9"><a href="epidemic-models---p3.html#cb112-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-10"><a href="epidemic-models---p3.html#cb112-10" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">mparse</span>(<span class="at">transitions =</span> transitions, <span class="at">compartments =</span> compartments, <span class="at">gdata =</span> <span class="fu">c</span>(<span class="at">beta =</span> beta), <span class="at">u0 =</span> initial_state, <span class="at">tspan =</span> tspan)</span>
<span id="cb112-11"><a href="epidemic-models---p3.html#cb112-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-12"><a href="epidemic-models---p3.html#cb112-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(model)</span>
<span id="cb112-13"><a href="epidemic-models---p3.html#cb112-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Make sure you save your file and that your working directory is the same as the folder you have saved this into (Choose from menu Session &gt; Set Working Directory &gt; To Source File Location).</p>
<p>This code creates a function that creates a single stochastic SI model. We’ll dissect/explain the code in the next section.</p>
<p>Open a new blank script file.</p>
<p>Save it as <code>Epi_P3.R</code></p>
<p>We’ll use this script to record all of the steps in this practical (unless otherwise indicated).</p>
<p>In the script window type the following commands and then run (select and press run button in RStudio):</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="epidemic-models---p3.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;Stoch_SI.R&#39;</span>)</span>
<span id="cb113-2"><a href="epidemic-models---p3.html#cb113-2" aria-hidden="true" tabindex="-1"></a>SImodel <span class="ot">&lt;-</span> <span class="fu">create.StocSI</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="dv">30</span>)</span>
<span id="cb113-3"><a href="epidemic-models---p3.html#cb113-3" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">run</span>(<span class="at">model =</span> SImodel)</span>
<span id="cb113-4"><a href="epidemic-models---p3.html#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out)</span></code></pre></div>
<p>You should see a graph that looks similar to this:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-136-1.png" style="display: block; margin: auto;" /></p>
<p>Here we can see the two trajectories for an SI epidemic. The susceptible curve (red) starts at 499 and stochastically decreases down whilst the infected curve (blue) starts at 1 and mirrors the S curve increasing stochastically.</p>
</div>
<div id="dissecting-the-stochastic-si-code" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Dissecting the stochastic SI code<a href="epidemic-models---p3.html#dissecting-the-stochastic-si-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The function we have just created is a wrapper that takes the basic parameters that define the SI model for a particular population and creates a R object that the <code>SimInf</code> package can use to simulate the model. Our function <code>create.StocSI</code> takes four inputs:</p>
<ul>
<li>Total population size: <span style="color:red">N</span></li>
<li>Initial number of infected: <span style="color:red">I0</span></li>
<li>Infection rate: <span style="color:red">beta</span></li>
<li>Time to simulate for: <span style="color:red">f_time</span></li>
</ul>
<p>Inside the function we combine this information to create four R objects that when passed to the <code>SimInf</code> function <code>mparse</code>. The output from the <code>mparse</code> function is returned as the output to our <code>create.StocSI</code> function.</p>
<p>Here we will break down what we have just written and explain what is required for the <code>mparse</code> function.</p>
<div class="panel panel-default">
<div class="panel-heading panel-heading2">
Note:
</div>
<div class="panel-body">
The <code>SimInf</code> package includes its own function that defines SIR, SEIR and SIS models (of which the SI model is a special case). The <code>mparse</code> function can define any generic compartmental model so it is worth learning about…
</div>
</div>
<p>The <code>mparse</code> function requires that you specify the following information:</p>
<ul>
<li>The list of all compartments of the system</li>
<li>The initial states (or compartments) of the system</li>
<li>the events (or transitions) of the system</li>
<li>the values of any parameters</li>
<li>the time points where the value of each state is to be recorded for each simulation</li>
</ul>
<p>An SI model is described by the following system of <em>differential</em> equations:</p>
<p><span class="math display">\[\frac{dS}{dt} = -\beta\frac{SI}{N}\]</span>
<span class="math display">\[\frac{dI}{dt} = \beta\frac{SI}{N}\]</span></p>
<p>And from these equations we can derive a transition diagram from the system:</p>
<p><span class="math display">\[ S \rightarrow \beta\frac{SI}{N} \rightarrow I\]</span></p>
<ul>
<li>From this diagram we can see that there are two states for this system: susceptible and infected (S &amp; I). We define all of the compartments of the model using a vector:</li>
</ul>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="epidemic-models---p3.html#cb114-1" aria-hidden="true" tabindex="-1"></a>compartments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>,<span class="st">&quot;I&quot;</span>)</span></code></pre></div>
<ul>
<li>In order to begin the simulation, we need to specify the initial values of each compartment. We specify these using a data frame with a single row and column for each compartment specified above:</li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="epidemic-models---p3.html#cb115-1" aria-hidden="true" tabindex="-1"></a>initial_state <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">S =</span> N<span class="sc">-</span>I0, <span class="at">I =</span> I0)</span></code></pre></div>
<p>where <code>N</code> (the total population number) and <code>I0</code> (the initial number of infected) have been specified by the user.</p>
<ul>
<li>There is one event (or transition): infection.</li>
</ul>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="epidemic-models---p3.html#cb116-1" aria-hidden="true" tabindex="-1"></a>transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S -&gt; beta*S*I/(S+I) -&gt; I&quot;</span>)</span></code></pre></div>
<p>where the effect is to move one susceptible into the infected compartment at a rate <span class="math inline">\(\beta \frac{SI}{N}\)</span> where <span class="math inline">\(N=S+I\)</span> and beta must be specified by the user. The syntax we use here should be self-explanatory (hopefully) but the idea is that we have the following syntax “A <span class="math inline">\(\rightarrow\)</span> rate <span class="math inline">\(\rightarrow\)</span> B” where A is the name of the starting compartment, B is the name of the ending compartment and rate explains how to calculate the rate.</p>
<ul>
<li>We must tell algorithm how long we want it to run for before stopping and at what points we wish to record the value of the compartments. We use the user specified variable <code>f_time</code> to specify a sequence of daily output values up to a maximum value of <code>f_time</code>.</li>
</ul>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="epidemic-models---p3.html#cb117-1" aria-hidden="true" tabindex="-1"></a>tspan <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> f_time, <span class="at">by =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>NB: <code>SimInf</code> was designed to work with real epidemiological data and as such the minimum output timestep size is 1 (corresponding to 1 day).</p>
<ul>
<li><p>The <code>mparse</code> function takes the arguments we’ve just created, processes (<em>‘parses’</em>) them into a low-level computer language and compiles the resulting program into machine code. This machine code is considerably (orders of magnitude) faster than the equivalent R code. We assign the output of this function to the object <code>SImodel</code> (An object in R is a special data type that combines functions with data).</p></li>
<li><p>Objects can be used as arguments to functions in the same way as normal data types. In this case we can use the <code>run()</code> function to run a stochastic simulation of the <code>SImodel</code>:</p></li>
</ul>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="epidemic-models---p3.html#cb118-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">run</span>(<span class="at">model =</span> SImodel, <span class="at">threads =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>The threads argument is optional here, but this argument would allow us to parallelise our code (if our setup allows it).</p>
<ul>
<li><p>The run function implements (and runs) the stochastic simulation algorithm for any stochastic model defined by the <code>mparse</code> function and returns a new object which contains the output of the simulation (which we’ve called out).</p></li>
<li><p>The <code>SimInf</code> package provides a special plot function for this output</p></li>
</ul>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="epidemic-models---p3.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out)</span></code></pre></div>
<p>This explains the code you’ve produced so far, but there are limitations. We would like to plot multiple stochastic realisations onto a single plot and investigate their aggregated properties. To do this we will need to modify our code somewhat.</p>
</div>
<div id="performing-multiple-simulations" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Performing Multiple Simulations<a href="epidemic-models---p3.html#performing-multiple-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s update our <code>create.StocSI</code> function in the (<code>Stoch_SI.R</code> file) to create a model with multiple copies of the same population. This is the simplest possible meta-population model where there is no interaction between patches, and a neat hack to run multiple replicate simulations at the same time.</p>
<p><strong>Edit <code>Stoch_SI.R</code> to update the definition of the <code>create.StocSI</code> as follows:</strong></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="epidemic-models---p3.html#cb120-1" aria-hidden="true" tabindex="-1"></a>create.StocSI <span class="ot">&lt;-</span> <span class="cf">function</span>(N, I0, beta, f_time, <span class="at">reps =</span> <span class="dv">1</span>) {</span>
<span id="cb120-2"><a href="epidemic-models---p3.html#cb120-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-3"><a href="epidemic-models---p3.html#cb120-3" aria-hidden="true" tabindex="-1"></a>    initial_state <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">S =</span> <span class="fu">rep</span>(N<span class="sc">-</span>I0, reps) , <span class="at">I =</span> <span class="fu">rep</span>(I0, reps))</span>
<span id="cb120-4"><a href="epidemic-models---p3.html#cb120-4" aria-hidden="true" tabindex="-1"></a>    compartments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;I&quot;</span>)</span>
<span id="cb120-5"><a href="epidemic-models---p3.html#cb120-5" aria-hidden="true" tabindex="-1"></a>    transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S -&gt; beta*S*I/(S+I) -&gt; I&quot;</span>)</span>
<span id="cb120-6"><a href="epidemic-models---p3.html#cb120-6" aria-hidden="true" tabindex="-1"></a>    tspan <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> f_time, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb120-7"><a href="epidemic-models---p3.html#cb120-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-8"><a href="epidemic-models---p3.html#cb120-8" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">mparse</span>(<span class="at">transitions =</span> transitions, <span class="at">compartments =</span> compartments, <span class="at">gdata =</span> <span class="fu">c</span>(<span class="at">beta =</span> beta), <span class="at">u0 =</span> initial_state, <span class="at">tspan =</span> tspan)</span>
<span id="cb120-9"><a href="epidemic-models---p3.html#cb120-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(model)</span>
<span id="cb120-10"><a href="epidemic-models---p3.html#cb120-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The only two things we’ve changed here are:</p>
<ol style="list-style-type: decimal">
<li><p>We’ve created a new argument call <code>reps</code> which we’re using to specify the number of simulations that we want the code to run.</p></li>
<li><p>We’ve changed how we specify the <code>initial_state</code> dataframe. This is now a dataframe that has <code>reps</code> number of rows and 2 columns. The first column contains the starting number of susceptible individuals in each of our simulations, and the second column contains the number of initial infected individuals.</p></li>
</ol>
<p>Again, remember to <strong>save</strong> your file.</p>
<div class="panel panel-default">
<div class="panel-heading panel-heading2">
Note:
</div>
<div class="panel-body">
we have added a new argument to <code>create.StocSI</code> which has a default value <code>reps</code><span class="math inline">\(=1\)</span>. By adding the argument in this way we ensure that any code we wrote earlier assuming only one replicate would still work with no modifications.
</div>
</div>
<p>Type in the following code into <code>Epi_P3.R</code> and run:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="epidemic-models---p3.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Multiple replicates</span></span>
<span id="cb121-2"><a href="epidemic-models---p3.html#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;Stoch_SI.R&#39;</span>)</span>
<span id="cb121-3"><a href="epidemic-models---p3.html#cb121-3" aria-hidden="true" tabindex="-1"></a>SImodel <span class="ot">&lt;-</span> <span class="fu">create.StocSI</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="dv">30</span>, <span class="dv">20</span>)</span>
<span id="cb121-4"><a href="epidemic-models---p3.html#cb121-4" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">run</span>(<span class="at">model =</span> SImodel)</span>
<span id="cb121-5"><a href="epidemic-models---p3.html#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out)</span></code></pre></div>
<p>This should produce a plot that looks similar to the following:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-147-1.png" style="display: block; margin: auto;" /></p>
<p>By default the plot command will always:</p>
<ol style="list-style-type: decimal">
<li><p>plot the curves for all states on the same graph (so we can see both S and I curves here)</p></li>
<li><p>use a step function to plot the curves (which is why it’s a bit, um, step-y)</p></li>
<li><p>show the average and interquartile range as a transparent envelope when multiple simulations have been run.</p></li>
</ol>
<p>If we want to actually see individual realisations, we need to use some of the other arguments to the plot function. <strong>Try typing this in:</strong></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="epidemic-models---p3.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out , <span class="st">&#39;I&#39;</span>, <span class="at">range=</span><span class="cn">FALSE</span> , <span class="at">type =</span> <span class="st">&#39;l&#39;</span>)</span></code></pre></div>
<p>This should produce a plot that look similar to the following:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-149-1.png" style="display: block; margin: auto;" /></p>
<ul>
<li>The second argument is a character vector specifying which compartments we want to see. Here we’ve asked to only see the curves for the infected I compartment.</li>
<li>The named argument <code>range</code> is used to specify the shaded quantile on the plot. By specifying <code>FALSE</code>, we’ve turned it off and forced R to plot the individual trajectories instead. If we’d specified a numeric value between 0 and 1 then we would see the equivalent shaded range plotted instead (i.e. <span class="math inline">\(range=0.5\)</span> corresponds to plotting the interquartile range and <span class="math inline">\(range = 0.95\)</span> corresponds to plotting the wider 95% quantiles)</li>
<li>We can use the standard <code>type</code> argument from the base R plot function to specify the type of curve we want. The default is <code>type='s'</code> for steps, but here we’re asking for the smoother <code>type='l'</code> lines option.</li>
</ul>
<div id="adding-the-deterministic-solution-curve" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Adding the deterministic solution curve<a href="epidemic-models---p3.html#adding-the-deterministic-solution-curve" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There will be an R script file called <code>Det_SI.R</code> on the shared drive (your demonstrator will know where). It contains the code for a deterministic SI model based upon the code you encountered in the first epidemic models practical. It is specifically designed to use the same parameters as have been used in the stochastic SI code written above and will add a deterministic trajectory to your plot.</p>
<p><strong>Type in the following:</strong></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="epidemic-models---p3.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding a deterministic trajectory</span></span>
<span id="cb123-2"><a href="epidemic-models---p3.html#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;Det_SI.r&#39;</span>)</span>
<span id="cb123-3"><a href="epidemic-models---p3.html#cb123-3" aria-hidden="true" tabindex="-1"></a>det.sol <span class="ot">&lt;-</span> <span class="fu">DetSI.dyn</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="dv">30</span>)</span>
<span id="cb123-4"><a href="epidemic-models---p3.html#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="epidemic-models---p3.html#cb123-5" aria-hidden="true" tabindex="-1"></a>det.t <span class="ot">&lt;-</span> det.sol[,<span class="dv">1</span>]</span>
<span id="cb123-6"><a href="epidemic-models---p3.html#cb123-6" aria-hidden="true" tabindex="-1"></a>det.I <span class="ot">&lt;-</span> det.sol[,<span class="dv">3</span>]</span>
<span id="cb123-7"><a href="epidemic-models---p3.html#cb123-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-8"><a href="epidemic-models---p3.html#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(det.t, det.I, <span class="at">lwd=</span><span class="dv">3</span> , <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-151-1.png" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exploring-the-effects-of-stochasticity" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Exploring the effects of Stochasticity<a href="epidemic-models---p3.html#exploring-the-effects-of-stochasticity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<p><strong>Exercise 1</strong></p>
<p>Modify the above code to explore the effects of different initial conditions <code>($I_{0}$ = 1, 5, 10, 50, 100)</code> on the stochastic replicates. Keep the total population size constant (<span class="math inline">\(N=500\)</span>).</p>
<strong>Qualitatively what effect does this have on the variability between replicates?</strong>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<p><strong>Exercise 2</strong></p>
<p>Now vary the population size <code>(N = 50, 500, 5000)</code> with <span class="math inline">\(I_{0} = 1\)</span>.</p>
<strong>Qualitatively what effect does this have on the variability between replicates?</strong>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<p><strong>Exercise 3</strong></p>
<p>Now vary the infection rate <span class="math inline">\((\beta = 0.1, 0.5, 1)\)</span>.</p>
<strong>Qualitatively what effect does this have on the variability between replicates?</strong>
</div>
</div>
</div>
<div id="the-delay-time" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> The delay time<a href="epidemic-models---p3.html#the-delay-time" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Graphical exploration of model output is a good way to orientate yourself and understand the qualitative impact of changing parameters, but in practice we do need to explore various summary statistics. In this section we will compare the time it takes for a stochastic epidemic to infect half of the total population, <span class="math inline">\(t_{\frac{1}{2}}\)</span>, with the time a deterministic epidemic takes. This difference is the delay time, <span class="math inline">\(\delta t\)</span> (see the figure below).</p>
<p><img src="Materials/Epidemic_models/Plots/plot_1.JPG" width="955" style="display: block; margin: auto;" /></p>
<p>We will repeat this for many stochastic replicates and plot a distribution of the delay times.</p>
<div id="the-deterministic-half-time" class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> The deterministic half-time<a href="epidemic-models---p3.html#the-deterministic-half-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The deterministic model predicts a constant value of <span class="math inline">\(t_{\frac{1}{2}}\)</span> given by the expression:</p>
<p><span class="math display">\[t_{\frac{1}{2}} = -\frac{1}{\beta}ln\frac{I_{0}}{N-I_{0}}\]</span></p>
<p>(This can be derived exactly from the analytic solution to the system of differential equations for the SI system. This isn’t going to be possible for more complex models).</p>
</div>
<div id="the-stochastic-half-time" class="section level3 hasAnchor" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> The stochastic half-time<a href="epidemic-models---p3.html#the-stochastic-half-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We must now construct a function that calculates the value of <span class="math inline">\(t_{\frac{1}{2}}\)</span> for a set of stochastic simulations and the corresponding delay times:</p>
<p>Open a new script file and save as <code>Half_time.R</code> with the following content:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="epidemic-models---p3.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Deterministic Halftime Function</span></span>
<span id="cb124-2"><a href="epidemic-models---p3.html#cb124-2" aria-hidden="true" tabindex="-1"></a>det_halftime <span class="ot">&lt;-</span> <span class="cf">function</span>(N, I0, beta) {</span>
<span id="cb124-3"><a href="epidemic-models---p3.html#cb124-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-4"><a href="epidemic-models---p3.html#cb124-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate deterministic half life</span></span>
<span id="cb124-5"><a href="epidemic-models---p3.html#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>((<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span>beta)<span class="sc">*</span><span class="fu">log</span>(I0<span class="sc">/</span>(N<span class="sc">-</span>I0)))</span>
<span id="cb124-6"><a href="epidemic-models---p3.html#cb124-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb124-7"><a href="epidemic-models---p3.html#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="epidemic-models---p3.html#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Stochastic Halftime Function</span></span>
<span id="cb124-9"><a href="epidemic-models---p3.html#cb124-9" aria-hidden="true" tabindex="-1"></a>stoc_halftime <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb124-10"><a href="epidemic-models---p3.html#cb124-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-11"><a href="epidemic-models---p3.html#cb124-11" aria-hidden="true" tabindex="-1"></a>    no_runs <span class="ot">=</span> <span class="fu">n_nodes</span>(model)</span>
<span id="cb124-12"><a href="epidemic-models---p3.html#cb124-12" aria-hidden="true" tabindex="-1"></a>    N <span class="ot">=</span> <span class="fu">sum</span>(model<span class="sc">@</span>u0[,<span class="dv">1</span>])</span>
<span id="cb124-13"><a href="epidemic-models---p3.html#cb124-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-14"><a href="epidemic-models---p3.html#cb124-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create storage vector for stochastic half lives</span></span>
<span id="cb124-15"><a href="epidemic-models---p3.html#cb124-15" aria-hidden="true" tabindex="-1"></a>    thalf <span class="ot">&lt;-</span> <span class="fu">numeric</span>(no_runs)</span>
<span id="cb124-16"><a href="epidemic-models---p3.html#cb124-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-17"><a href="epidemic-models---p3.html#cb124-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loop over number of replicates</span></span>
<span id="cb124-18"><a href="epidemic-models---p3.html#cb124-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (iSim <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>no_runs) {</span>
<span id="cb124-19"><a href="epidemic-models---p3.html#cb124-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># extract the infected time series for each simulation</span></span>
<span id="cb124-20"><a href="epidemic-models---p3.html#cb124-20" aria-hidden="true" tabindex="-1"></a>        output <span class="ot">&lt;-</span> <span class="fu">trajectory</span>(out, <span class="st">&quot;I&quot;</span>, iSim)</span>
<span id="cb124-21"><a href="epidemic-models---p3.html#cb124-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb124-22"><a href="epidemic-models---p3.html#cb124-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># find the first time when the infected population is at least half the total population</span></span>
<span id="cb124-23"><a href="epidemic-models---p3.html#cb124-23" aria-hidden="true" tabindex="-1"></a>        ind <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">which</span>(output<span class="sc">$</span>I<span class="sc">&gt;=</span>(N<span class="sc">/</span><span class="dv">2</span>)))</span>
<span id="cb124-24"><a href="epidemic-models---p3.html#cb124-24" aria-hidden="true" tabindex="-1"></a>        thalf[iSim] <span class="ot">&lt;-</span> output<span class="sc">$</span>time[ind]</span>
<span id="cb124-25"><a href="epidemic-models---p3.html#cb124-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb124-26"><a href="epidemic-models---p3.html#cb124-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb124-27"><a href="epidemic-models---p3.html#cb124-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(thalf)</span>
<span id="cb124-28"><a href="epidemic-models---p3.html#cb124-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The function <code>det_halftime</code> takes three arguments:</p>
<ul>
<li>The total host population <span style="color:red">N</span></li>
<li>The initial number of infected <span style="color:red">I0</span></li>
<li>The infection rate <span style="color:red">beta</span></li>
</ul>
<p>and returns the deterministic value of the time to half-height.</p>
<p>The function <code>stoc_halftime</code> takes a SimInf model object as its input and returns a vector with the time to half height of each model simulation (to nearest day)</p>
<p>We then plot a probability density plot for these delay times using the in-built function <code>density</code>.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="epidemic-models---p3.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;Half_time.R&#39;</span>)</span>
<span id="cb125-2"><a href="epidemic-models---p3.html#cb125-2" aria-hidden="true" tabindex="-1"></a>SImodel <span class="ot">&lt;-</span> <span class="fu">create.StocSI</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.5</span>, <span class="dv">30</span>, <span class="dv">100</span>)</span>
<span id="cb125-3"><a href="epidemic-models---p3.html#cb125-3" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">run</span>(<span class="at">model =</span> SImodel)</span>
<span id="cb125-4"><a href="epidemic-models---p3.html#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="epidemic-models---p3.html#cb125-5" aria-hidden="true" tabindex="-1"></a>delay_times <span class="ot">&lt;-</span> <span class="fu">stoc_halftime</span>(out) <span class="sc">-</span> <span class="fu">det_halftime</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb125-6"><a href="epidemic-models---p3.html#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="epidemic-models---p3.html#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(delay_times), <span class="at">main =</span> <span class="st">&#39;&#39;</span>)</span></code></pre></div>
<p><code>density</code> produces smoothed estimates of the frequency distributions of a set of samples (essentially a smooth line through the top of a histogram). This will produce a figure similar to the one below:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-158-1.png" style="display: block; margin: auto;" /></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<p><strong>Exercise</strong></p>
Can the distribution of delay-times be used to quantify the appropriateness of the deterministic approximation for a given set of parameters? In particular, in what limits will the deterministic model produce useful predictions for the time-scale of an SI epidemic? You may wish to revisit the impact of changing the host-population size N, initial number of infectives <span class="math inline">\(I_{0}\)</span> and infection rate. Produce plots to justify your reasoning and discuss them with a demonstrator.
</div>
</div>
</div>
</div>
<div id="coding-a-simple-sir-model" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Coding a simple SIR model<a href="epidemic-models---p3.html#coding-a-simple-sir-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using the results from the earlier section on SI models as a starting point we will construct a stochastic SIR model. The deterministic SIR model equations are given by</p>
<p><span class="math display">\[\frac{dS}{dt} = -\beta\frac{SI}{N}\]</span>
<span class="math display">\[\frac{dI}{dt} = \beta\frac{SI}{N}-\mu I\]</span>
<span class="math display">\[\frac{dR}{dt} = \mu I\]</span></p>
<div id="exercise-one" class="section level3 hasAnchor" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> Exercise one<a href="epidemic-models---p3.html#exercise-one" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Using these equations construct a transition diagram for the system</li>
<li>What are the states/compartments for this system?</li>
<li>What are the transitions events and what are the rates associated with each event?</li>
<li>What is the initial state of the system (i.e. how many individuals should be in each compartment initially)?</li>
</ol>
<p>One a new script in RStudio.</p>
<p>Using the functions developed in the previous sections as a template construct a <code>create.StocSIR</code> function that takes five arguments:</p>
<ul>
<li>N: the total population size</li>
<li>I0: the initial number of infected individuals</li>
<li>beta: the infection rate</li>
<li>mu: the recovery rate</li>
<li>f_time: the time the simulation will run for (daily steps)</li>
<li>reps: the number of replicate simulations to run</li>
</ul>
<p>The skeleton function below can serve as a starting point.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="epidemic-models---p3.html#cb126-1" aria-hidden="true" tabindex="-1"></a>create.StocSIR <span class="ot">&lt;-</span> <span class="cf">function</span>(N, I0, beta, mu, f_time, <span class="at">reps =</span> <span class="dv">1</span>) {</span>
<span id="cb126-2"><a href="epidemic-models---p3.html#cb126-2" aria-hidden="true" tabindex="-1"></a>    initial_state <span class="ot">&lt;-</span></span>
<span id="cb126-3"><a href="epidemic-models---p3.html#cb126-3" aria-hidden="true" tabindex="-1"></a>    compartments <span class="ot">&lt;-</span></span>
<span id="cb126-4"><a href="epidemic-models---p3.html#cb126-4" aria-hidden="true" tabindex="-1"></a>    transitions <span class="ot">&lt;-</span></span>
<span id="cb126-5"><a href="epidemic-models---p3.html#cb126-5" aria-hidden="true" tabindex="-1"></a>    tspan <span class="ot">&lt;-</span></span>
<span id="cb126-6"><a href="epidemic-models---p3.html#cb126-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-7"><a href="epidemic-models---p3.html#cb126-7" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">mparse</span>(<span class="at">transitions =</span> transitions,</span>
<span id="cb126-8"><a href="epidemic-models---p3.html#cb126-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">compartments =</span> compartments,</span>
<span id="cb126-9"><a href="epidemic-models---p3.html#cb126-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">gdata =</span> <span class="fu">c</span>(<span class="at">beta =</span> beta, <span class="at">mu =</span> mu),</span>
<span id="cb126-10"><a href="epidemic-models---p3.html#cb126-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">u0 =</span> initial_state,</span>
<span id="cb126-11"><a href="epidemic-models---p3.html#cb126-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">tspan =</span> tspan)</span>
<span id="cb126-12"><a href="epidemic-models---p3.html#cb126-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-13"><a href="epidemic-models---p3.html#cb126-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(model)</span>
<span id="cb126-14"><a href="epidemic-models---p3.html#cb126-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-15"><a href="epidemic-models---p3.html#cb126-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="panel panel-default">
<div class="panel-heading panel-heading2">
Hint
</div>
<div class="panel-body">
<p>To specify multiple transitions in the <code>SimInf</code> algorithm you will need a transitions vector with two elements to it like this:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="epidemic-models---p3.html#cb127-1" aria-hidden="true" tabindex="-1"></a>tansitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;S -&gt; ?? -&gt; I&#39;</span>, <span class="st">&#39;I -&gt; ?? -&gt; R&#39;</span>)</span></code></pre></div>
where I have deliberately replaced the relevant transition rates with ??. You will need to replace the ?? with the correct rate equations.
</div>
</div>
<p>Using your function run the following code:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="epidemic-models---p3.html#cb128-1" aria-hidden="true" tabindex="-1"></a>SIRmodel <span class="ot">&lt;-</span> <span class="fu">create.StocSIR</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="dv">30</span>)</span>
<span id="cb128-2"><a href="epidemic-models---p3.html#cb128-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">run</span>(<span class="at">model =</span> SIRmodel)</span>
<span id="cb128-3"><a href="epidemic-models---p3.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out)</span></code></pre></div>
<p>This should produce a graph that looks like this:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-163-1.png" style="display: block; margin: auto;" /></p>
<p>However, some of you will see a very different graph. (If you do get something like this plot then try rerunning the model and plotting it several times until you see something different.)</p>
<p><strong>Why might this be the case?</strong></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
</div>
<div id="exercise-two" class="section level3 hasAnchor" number="7.6.2">
<h3><span class="header-section-number">7.6.2</span> Exercise two<a href="epidemic-models---p3.html#exercise-two" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use this function to plot 50 replicates of the infection curves (use the code in the previous SI section as a guide.</p>
<p>This should produce a graph that looks like this:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-164-1.png" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-three" class="section level3 hasAnchor" number="7.6.3">
<h3><span class="header-section-number">7.6.3</span> Exercise three<a href="epidemic-models---p3.html#exercise-three" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Load the R script called <code>Det_SIR.R</code> and adapting your code from the previous section make a plot that overlays the deterministic solution with the output of the stochastic model.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-165-1.png" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="sis-extension-adding-recovery-from-infection" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> SIS Extension: Adding Recovery from Infection<a href="epidemic-models---p3.html#sis-extension-adding-recovery-from-infection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider a system where individuals recover from infection with a fixed rate <span class="math inline">\(\alpha\)</span> and return to the susceptible class. This SIS system is described by the following system of equations:</p>
<p><span class="math display">\[\begin{aligned} \frac{dS}{dt} &amp;= \alpha I - \beta\frac{SI}{N} \\ \frac{dI}{dt} &amp;= \beta\frac{SI}{N} - \alpha I \end{aligned}\]</span></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">

<ol style="list-style-type: decimal">
<li><p>Draw the transition diagram for this system.</p></li>
<li><p>For each transition write down the rate at which it occurs.</p></li>
<li><p>What are the parameters required for this model?</p></li>
<li><p>Write a new function <code>create.StocSIS</code> based upon the <code>create.StocSI</code> function and add to the <code>Stoch_SI.R</code> file and repeat the above analysis.</p>
</div>
</div></li>
</ol>
</div>
<div id="sis-extension-adding-host-demography" class="section level2 hasAnchor" number="7.8">
<h2><span class="header-section-number">7.8</span> SIS Extension: Adding host demography<a href="epidemic-models---p3.html#sis-extension-adding-host-demography" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider an SI model with host demography. The system has constant birth rate <span class="math inline">\(\Lambda\)</span> into the susceptible class and fixed per capita mortality rate <span class="math inline">\(\mu\)</span> from both the susceptible and infectious classes and is governed by the following equations:</p>
<p><span class="math display">\[\frac{dS}{dt} = \Lambda - \beta\frac{SI}{N} - \mu S\]</span>
<span class="math display">\[\frac{dI}{dt} = \beta\frac{SI}{N}-\mu I\]</span></p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Repeat the previous steps for this model and create a <code>create.StocSI_demo</code> function in <code>Stoch_SI.R</code> and then explore its dynamics.
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading panel-heading2">
Hint
</div>
<div class="panel-body">

<ul>
<li>To specify a birth (or death) event then we use the @ symbol to represent the “empty” compartment from which births appear (or to which deaths end up). So a birth event into the susceptible compartment would have the following transition string:</li>
</ul>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="epidemic-models---p3.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;@ -&gt; ?? -&gt; S&#39;</span></span></code></pre></div>
<ul>
<li>Use these initial values for the parameters:
<ul>
<li>alpha <span class="math inline">\(= 0.1\)</span></li>
<li>beta <span class="math inline">\(=0.5\)</span></li>
<li>lambda <span class="math inline">\(=100\)</span>
</div>
</div></li>
</ul></li>
</ul>
</div>
<div id="sir-extension-the-final-epidemic-size" class="section level2 hasAnchor" number="7.9">
<h2><span class="header-section-number">7.9</span> SIR Extension: The final epidemic size<a href="epidemic-models---p3.html#sir-extension-the-final-epidemic-size" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to further explore the effects of stochasticity in the SIR model we are going to explore the how the final size of an epidemic varies between realisations.</p>
<div id="exercise-one-1" class="section level3 hasAnchor" number="7.9.1">
<h3><span class="header-section-number">7.9.1</span> Exercise one<a href="epidemic-models---p3.html#exercise-one-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<ul>
<li>What is the final size of an epidemic?</li>
<li>What does it mean?</li>
<li>Which state variable do we need to consider in order to calculate the final epidemic size?</li>
</ul>
For stochastic simulations the final epidemic size will vary between realisations of the epidemic which will mean that we need to think about a <em>distribution</em> of final epidemic sizes.
</div>
</div>
</div>
<div id="exercise-two-1" class="section level3 hasAnchor" number="7.9.2">
<h3><span class="header-section-number">7.9.2</span> Exercise two<a href="epidemic-models---p3.html#exercise-two-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
Write code to calculate the final epidemic size from a <code>SimInf</code> output object.
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading panel-heading2">
Hint
</div>
<div class="panel-body">

<ul>
<li>What value should the final time for the simulations be set to (roughly)?</li>
<li>As we’ve seen before, the function <code>trajectory</code> can be used to extract the actual values of the different compartments at each time point.</li>
<li>Look at the code we used in the previous practical for calculating the halftime values for a single simulation and modify that logic accordingly.
</div>
</div></li>
</ul>
</div>
<div id="exercise-three-1" class="section level3 hasAnchor" number="7.9.3">
<h3><span class="header-section-number">7.9.3</span> Exercise three<a href="epidemic-models---p3.html#exercise-three-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<p>Run 100 realisations, extract the final epidemic size from each one and then produce a histogram of the final sizes. It should look something similar to the figure below:</p>
<img src="Materials/Epidemic_models/Plots/plot_2.JPG" width="494" style="display: block; margin: auto;" />
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading panel-heading2">
Hint
</div>
<div class="panel-body">

<ul>
<li>You’ll probably want to use a loop to extract the final size for each simulation</li>
<li>Set the histogram to use 500 bins
</div>
</div></li>
</ul>
<p><strong>Why does the histogram have a bimodal distribution?</strong></p>
</div>
<div id="exercise-four" class="section level3 hasAnchor" number="7.9.4">
<h3><span class="header-section-number">7.9.4</span> Exercise four<a href="epidemic-models---p3.html#exercise-four" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall that the final epidemic size for the deterministic SIR model showed strong dependency on the value of the basic reproductive number, <span class="math inline">\(R_{0}\)</span>.</p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">

<ul>
<li>Write down an expression for <span class="math inline">\(R_{0}\)</span> for this system as a function of the parameters <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\mu\)</span>.</li>
<li>Does this help explain the bimodal result?
</div>
</div></li>
</ul>
</div>
<div id="exercise-five" class="section level3 hasAnchor" number="7.9.5">
<h3><span class="header-section-number">7.9.5</span> Exercise five<a href="epidemic-models---p3.html#exercise-five" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For this section, we shall vary the value of <span class="math inline">\(R_{0}\)</span> by varying the transmission rate, <span class="math inline">\(\beta\)</span>, whilst keeping the recovery rate, <span class="math inline">\(\mu\)</span>, at a fixed value.</p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">
<p>Explore how the final size distribution varies with R0 by producing histograms of the final size distribution as per the above figure for values of <span class="math inline">\(R_{0} = 20.0\)</span>, <span class="math inline">\(5.0\)</span>, <span class="math inline">\(2.0\)</span>, <span class="math inline">\(1.2\)</span>, <span class="math inline">\(1.0\)</span>, <span class="math inline">\(0.9\)</span>, <span class="math inline">\(0.5\)</span>.</p>
Can you always identify the two modes of the distribution?
</div>
</div>
</div>
</div>
<div id="sir-extension-stochastic-extinction" class="section level2 hasAnchor" number="7.10">
<h2><span class="header-section-number">7.10</span> SIR Extension: Stochastic extinction<a href="epidemic-models---p3.html#sir-extension-stochastic-extinction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One of the primary differences between the deterministic and stochastic formulations of the SIR model is that in the stochastic formulation the epidemic becomes extinct within a finite time, the so-called extinction time. The extinction time varies between realisations and in this section we are going to explore this distribution.</p>
<div id="question" class="section level3 hasAnchor" number="7.10.1">
<h3><span class="header-section-number">7.10.1</span> Question<a href="epidemic-models---p3.html#question" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Which state variable do we need to consider in order to calculate the time to epidemic extinction and what is the value of this state variable at extinction?</p>
</div>
<div id="exercise-one-2" class="section level3 hasAnchor" number="7.10.2">
<h3><span class="header-section-number">7.10.2</span> Exercise one<a href="epidemic-models---p3.html#exercise-one-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As with the final epidemic size, the extinction time will vary over realisations of the epidemic which will result in a distribution of extinction times, which we are now going to explore.</p>
<div class="panel panel-default">
<div class="panel-heading">
Task
</div>
<div class="panel-body">

<p>Adapt your previous code to calculate the extinction time for each realisation.</p>
<ul>
<li>What value should the final time for the simulation be set to?</li>
<li>Run 100 realisations in order to produce a histogram of the time to extinction, as per the figure below:</li>
</ul>
<p><img src="Materials/Epidemic_models/Plots/plot_3.JPG" width="605" style="display: block; margin: auto;" /></p>
<ul>
<li><p>Explore the distribution of extinction times for several values of <span class="math inline">\(R_{0} = 20.0\)</span>, <span class="math inline">\(5.0\)</span>, <span class="math inline">\(2.0\)</span>, <span class="math inline">\(1.2\)</span>, <span class="math inline">\(1.0\)</span>, <span class="math inline">\(0.9\)</span>, <span class="math inline">\(0.5\)</span>.</p></li>
<li><p>What do you notice about the distribution as <span class="math inline">\(R_{0}\)</span> gets close to 1?</p>
</div>
</div></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="epidemic-models---p2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="estimating-r_0---p1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
